[include mainsail.cfg]
[include config/mcu.cfg]
[include config/machine.cfg]
[include config/stepper_motors.cfg]
[include config/extruder.cfg]
[include config/fans.cfg]
[include extras/*.cfg]

#####################################################################
#  Kinematics
#####################################################################

[printer]
kinematics: corexy
max_velocity: 400
max_accel: 8000
max_z_velocity: 30
max_z_accel: 500
# minimum_cruise_ratio: 0.5 # This left commented to not break older Klipper versions
square_corner_velocity: 5.0

[extruder]
step_pin: EBBCan: gpio18
dir_pin: EBBCan: gpio19
enable_pin: !EBBCan: gpio17
microsteps: 16
gear_ratio: 50:17
rotation_distance: 13.365
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: gpio7
max_extrude_only_distance: 500
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: EBBCan:gpio27
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
#min_temp: 0
#max_temp: 300
#min_extrude_temp: 190
sensor_type: MAX31865
sensor_pin: EBBCan:gpio9
spi_software_sclk_pin: EBBCan:gpio10
spi_software_mosi_pin: EBBCan:gpio8
spi_software_miso_pin: EBBCan:gpio11
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
control: pid
pid_kp: 18.288
pid_ki: 1.008
pid_kd: 82.978
min_temp: 0
max_temp: 280
min_extrude_temp: 0

[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PB1
max_power: 1.0
min_temp: 0
max_temp: 120
control: pid
pid_kp: 57.866
pid_ki: 2.204
pid_kd: 379.748

# [neopixel hotend_rgb]
# pin: EBBCan:gpio16

[temperature_sensor plate]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA7
min_temp: 0
max_temp: 100

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: PC4
min_temp: 0
max_temp: 100
gcode_id: C

[temperature_sensor MCU]
sensor_type: temperature_mcu

[temperature_sensor M8P]
sensor_type: temperature_host

[temperature_sensor SB]
sensor_type: Generic 3950
sensor_pin: EBBCan:gpio28

[adxl345]
cs_pin: EBBCan:gpio1
spi_software_sclk_pin: EBBCan:gpio2
spi_software_mosi_pin: EBBCan:gpio0
spi_software_miso_pin: EBBCan:gpio3
axes_map: z,-y,x

[resonance_tester]
probe_points: 100, 100, 20
accel_chip: adxl345

#[filament_switch_sensor runout_sensor]
#switch_pin: EBBCan:gpio21
#pause_on_runout: True

[output_pin caselight]
# Chamber Lighting - HE2 Connector
pin: PA3
pwm:true
shutdown_value: 0
value:0.0
cycle_time: 0.01

#[output_pin vefach]
# Chamber Lighting - HE3 Connector
#pin: PA5
#pwm:true
#shutdown_value: 0
#value:0.0
#cycle_time: 0.01

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead

##--------------------------------------------------------------------
## Uncomment below for 250mm build
z_positions:
    -50, 18
    125, 245
    300, 18
points:
    230, 10
    10, 10
    127, 200
    

##--------------------------------------------------------------------

speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075


[safe_z_home]
home_xy_position: 127, 127
z_hop: 10
z_hop_speed: 25
speed: 200

#####################################################################
# 	Fan Control
#####################################################################

[heater_fan hotend_fan]
pin: EBBCan: gpio15
tachometer_pin: ^EBBCan:gpio12
tachometer_ppr: 2
kick_start_time: 0.5
off_below: 0.5
heater: extruder
heater_temp: 50.0

[fan]
pin: EBBCan: gpio13
max_power: 1.0
kick_start_time: 0.5

##  If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

#[fan]
#pin: EBBCan: gpio13 
#kick_start_time: 0.5
#off_below: 0.10

#[heater_fan hotend_fan]
#pin: EBBCan: gpio12
#heater: extruder
#heater_temp: 48.0
##  If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 0.0
#[fan_generic 4W_FAN0]
#pin: EBBCan:gpio15

#heater: extruder
#heater_temp: 48.0
##  If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 0.0

[multi_pin controller_fans]
pins: PF7,PF9

[controller_fan controller_fan]
##  Controller fan
pin: multi_pin:controller_fans
max_power: 0.4
kick_start_time: 0.5
heater: heater_bed

[fan_generic BedFans]
pin: PA4
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic vefach]
pin: PF6
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic nevermore]
pin: PF8
shutdown_speed: 0.0
kick_start_time: 5.0

###############################Macros and related################################
#This secton contains macros and related config sections. Some should be used, others are optional. Read the comment above each one to find out whether or not to uncomment it for your installation.


[save_variables]
filename: ~/printer_data/config/variables.cfg

[force_move]
enable_force_move: True # Allows a user to move the z axis down if they have no other means of homing Z and need to calibrate the Eddy.

#[bed_mesh]
#horizontal_move_z: 2
#speed: 500
#mesh_min: 20, 22  # modify these according to the above guide. If the probe cannot reach then you will get a klipper error when trying to scan a bed mesh.
#mesh_max: 225, 210 # modify these according to the above guide. If the probe cannot reach then you will get a klipper error when trying to scan a bed mesh.
#probe_count: 6, 6
#algorithm: bicubic
#scan_overshoot: 8  #uncomment this section if you still have room left over on the X axis for some scan overshoot to product smoother movements and more accurate scanning. Uncommenting this should be fine if you are using a standard voron mount.

#[probe]
#pin: ^EBBCan: gpio22
#z_offset: 0
#speed: 10.0
#samples: 3
#samples_result: median
#sample_retract_dist: 3.0
#samples_tolerance: 0.006
#samples_tolerance_retries: 3

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 20                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.00244
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 127, 127    
#    set this to the middle of your bed
speed: 500
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 20, 22  # modify these according to the above guide. If the probe cannot reach then you will get a klipper error when trying to scan a bed mesh.
mesh_max: 225, 210 # modify these according to the above guide. If the probe cannot reach then you will get a klipper error when trying to scan a bed mesh.
#    start point of bed mesh [X, Y]
#mesh_max: 240, 198
#    end point of bed mesh [X, Y]
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*#
#*# [scanner model default]
#*# model_coef = 1.4666072485520556,
#*# 	1.897877898798068,
#*# 	0.7692876659825716,
#*# 	0.37785838946912303,
#*# 	0.3052998919606561,
#*# 	0.2056426818632206,
#*# 	-0.13341219602893212,
#*# 	-0.11926661681853419,
#*# 	0.14335986342531482,
#*# 	0.09134106438267255
#*# model_domain = 3.2212501390279064e-07,3.314579013020648e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 21.667490
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.183656, 0.180944, 0.177216, 0.168921, 0.162244, 0.148375, 0.142427, 0.130355, 0.119034, 0.108705, 0.098212, 0.087393, 0.077635, 0.072489, 0.064427, 0.058104, 0.050978, 0.045422, 0.041453, 0.037596, 0.032397, 0.025670, 0.019794, 0.011485, 0.007435, 0.000020, -0.013301, -0.030542, -0.042186, -0.049740
#*# 	  0.189430, 0.183680, 0.173928, 0.168854, 0.159436, 0.153726, 0.138078, 0.129358, 0.116374, 0.102585, 0.096047, 0.081191, 0.076247, 0.067520, 0.062231, 0.052312, 0.044061, 0.039395, 0.034418, 0.031460, 0.025445, 0.017789, 0.011450, 0.004944, 0.000154, -0.006346, -0.018461, -0.033115, -0.045586, -0.056188
#*# 	  0.184800, 0.181629, 0.175677, 0.167937, 0.158650, 0.144786, 0.135977, 0.123573, 0.111989, 0.100908, 0.088922, 0.076805, 0.066358, 0.059234, 0.053215, 0.046545, 0.039207, 0.033678, 0.029252, 0.023204, 0.017430, 0.010069, 0.003922, -0.002258, -0.005454, -0.014441, -0.023285, -0.034871, -0.054200, -0.065925
#*# 	  0.178061, 0.174449, 0.173212, 0.165908, 0.156193, 0.144582, 0.129101, 0.119652, 0.105487, 0.097353, 0.084345, 0.077991, 0.062801, 0.054562, 0.048462, 0.040382, 0.033687, 0.027839, 0.026705, 0.017214, 0.011861, 0.003163, -0.005541, -0.010356, -0.014997, -0.020962, -0.030614, -0.041147, -0.057782, -0.074802
#*# 	  0.167865, 0.170635, 0.168695, 0.161027, 0.151706, 0.137617, 0.127956, 0.113837, 0.104979, 0.090821, 0.078072, 0.068186, 0.057290, 0.050194, 0.042398, 0.035437, 0.027721, 0.021044, 0.015225, 0.011364, 0.006030, -0.002696, -0.011504, -0.017815, -0.019763, -0.027047, -0.034396, -0.044495, -0.062473, -0.080498
#*# 	  0.159256, 0.166131, 0.165432, 0.157097, 0.147462, 0.132343, 0.121541, 0.107141, 0.095961, 0.085109, 0.070702, 0.064765, 0.050757, 0.044875, 0.033728, 0.027048, 0.020524, 0.011647, 0.009609, 0.004735, -0.001382, -0.008594, -0.016515, -0.023656, -0.028731, -0.034849, -0.040675, -0.050319, -0.063985, -0.084521
#*# 	  0.156880, 0.163878, 0.165261, 0.154592, 0.143181, 0.129439, 0.116466, 0.102730, 0.091254, 0.079296, 0.068159, 0.058194, 0.046251, 0.039971, 0.027084, 0.021217, 0.014248, 0.005501, 0.000584, -0.004510, -0.009158, -0.016343, -0.022402, -0.028083, -0.032132, -0.039980, -0.049403, -0.061890, -0.073961, -0.087998
#*# 	  0.159481, 0.164554, 0.159518, 0.153380, 0.138364, 0.124731, 0.112194, 0.096570, 0.087134, 0.072785, 0.062370, 0.048526, 0.042922, 0.032144, 0.020695, 0.014341, 0.007717, -0.000965, -0.004712, -0.009182, -0.015469, -0.021005, -0.029662, -0.032695, -0.038431, -0.045955, -0.057097, -0.070024, -0.080429, -0.095811
#*# 	  0.157527, 0.160760, 0.154483, 0.144014, 0.130129, 0.118815, 0.101248, 0.091659, 0.075923, 0.066248, 0.054938, 0.041694, 0.033911, 0.024716, 0.015778, 0.008283, 0.002492, -0.005985, -0.010066, -0.015128, -0.021052, -0.029499, -0.037399, -0.041699, -0.044776, -0.053436, -0.067934, -0.081006, -0.090047, -0.102416
#*# 	  0.153569, 0.156136, 0.149390, 0.137408, 0.123693, 0.110753, 0.096211, 0.081523, 0.069351, 0.057874, 0.043443, 0.034988, 0.024947, 0.018859, 0.006454, 0.001914, -0.004357, -0.010865, -0.016067, -0.020978, -0.027935, -0.036420, -0.044361, -0.049193, -0.052275, -0.063422, -0.076441, -0.090173, -0.098787, -0.112055
#*# 	  0.151256, 0.151341, 0.140086, 0.131975, 0.116479, 0.105255, 0.088088, 0.073337, 0.061080, 0.049234, 0.038449, 0.025395, 0.017383, 0.009714, 0.003328, -0.003178, -0.007762, -0.013779, -0.018019, -0.026657, -0.033220, -0.042276, -0.050669, -0.055738, -0.059526, -0.070515, -0.083958, -0.094126, -0.105194, -0.114939
#*# 	  0.153257, 0.149302, 0.140339, 0.128633, 0.114512, 0.097804, 0.084065, 0.068130, 0.058047, 0.045343, 0.033948, 0.022090, 0.013630, 0.007702, 0.000007, -0.000826, -0.006459, -0.011414, -0.018303, -0.028109, -0.035358, -0.043163, -0.053166, -0.059200, -0.062882, -0.073300, -0.084720, -0.093088, -0.105907, -0.113931
#*# 	  0.158774, 0.150779, 0.142411, 0.127861, 0.114268, 0.098206, 0.081734, 0.069293, 0.056728, 0.045775, 0.033510, 0.023158, 0.014458, 0.008589, 0.004842, 0.001248, -0.001370, -0.006543, -0.013433, -0.023860, -0.032824, -0.042715, -0.052135, -0.058191, -0.061719, -0.071027, -0.080452, -0.091466, -0.099476, -0.107580
#*# 	  0.160269, 0.155355, 0.141373, 0.130497, 0.113807, 0.096088, 0.082528, 0.067764, 0.059346, 0.046512, 0.035106, 0.025065, 0.017045, 0.013719, 0.009817, 0.004539, 0.001103, -0.004035, -0.009580, -0.017908, -0.029946, -0.041909, -0.051753, -0.058282, -0.061921, -0.070385, -0.076634, -0.085055, -0.092952, -0.101740
#*# 	  0.161921, 0.154952, 0.141823, 0.128832, 0.110203, 0.099151, 0.080066, 0.069171, 0.056350, 0.048669, 0.033274, 0.024728, 0.019590, 0.014021, 0.009794, 0.007078, 0.000654, -0.002084, -0.008719, -0.017186, -0.030460, -0.040725, -0.051350, -0.055706, -0.060483, -0.068011, -0.075573, -0.081407, -0.090064, -0.099346
#*# 	  0.161684, 0.151489, 0.139547, 0.126230, 0.110158, 0.095992, 0.081860, 0.066426, 0.057635, 0.042616, 0.029042, 0.022957, 0.018786, 0.015823, 0.011720, 0.008351, -0.001671, -0.004409, -0.012726, -0.019770, -0.030956, -0.042093, -0.053258, -0.059329, -0.061872, -0.069390, -0.075695, -0.082467, -0.090534, -0.098591
#*# 	  0.158652, 0.147697, 0.131943, 0.119570, 0.107331, 0.091487, 0.079863, 0.061803, 0.050083, 0.034831, 0.023478, 0.016442, 0.011605, 0.010581, 0.006257, 0.001656, -0.004492, -0.012430, -0.017888, -0.026114, -0.036861, -0.048102, -0.057029, -0.063802, -0.065760, -0.073316, -0.080307, -0.085067, -0.092596, -0.102877
#*# 	  0.152419, 0.142140, 0.128833, 0.114362, 0.100743, 0.087314, 0.072680, 0.056778, 0.045466, 0.031012, 0.017987, 0.010092, 0.004968, 0.001763, -0.000093, -0.004282, -0.009181, -0.017050, -0.024370, -0.035483, -0.045715, -0.053652, -0.062299, -0.069929, -0.071709, -0.078068, -0.084504, -0.090365, -0.098482, -0.108790
#*# 	  0.147977, 0.138956, 0.125195, 0.109108, 0.097080, 0.083793, 0.069606, 0.053747, 0.041758, 0.029154, 0.013763, 0.009617, -0.000729, -0.003609, -0.009041, -0.010614, -0.018075, -0.023761, -0.031497, -0.044521, -0.049300, -0.057623, -0.065361, -0.070981, -0.075501, -0.079926, -0.087091, -0.092235, -0.099723, -0.110012
#*# 	  0.143818, 0.131255, 0.120206, 0.105278, 0.091064, 0.079167, 0.065041, 0.050201, 0.037485, 0.024982, 0.014055, 0.003322, -0.003354, -0.009891, -0.014988, -0.018936, -0.024830, -0.032240, -0.039615, -0.048057, -0.054871, -0.061405, -0.066149, -0.074455, -0.078030, -0.083901, -0.088181, -0.094800, -0.101910, -0.111701
#*# 	  0.135207, 0.123943, 0.113393, 0.095944, 0.085105, 0.072879, 0.060905, 0.044111, 0.031201, 0.019811, 0.009063, 0.002564, -0.009728, -0.015062, -0.022633, -0.026461, -0.034912, -0.041338, -0.044618, -0.053968, -0.058656, -0.066480, -0.073271, -0.078139, -0.081007, -0.087223, -0.095273, -0.099106, -0.106091, -0.115783
#*# 	  0.128465, 0.117729, 0.105219, 0.091651, 0.077000, 0.063455, 0.051500, 0.037263, 0.024933, 0.014060, 0.003449, -0.004563, -0.014962, -0.023142, -0.028794, -0.035700, -0.042382, -0.048067, -0.056818, -0.060074, -0.068401, -0.071680, -0.078842, -0.084036, -0.087238, -0.092931, -0.098794, -0.107133, -0.113512, -0.121431
#*# 	  0.120753, 0.110854, 0.099284, 0.083239, 0.070156, 0.058189, 0.044842, 0.032019, 0.017694, 0.007871, -0.001299, -0.011829, -0.020790, -0.028146, -0.037546, -0.040533, -0.048833, -0.054434, -0.059329, -0.064524, -0.069614, -0.075327, -0.081994, -0.088773, -0.091773, -0.096891, -0.102763, -0.109618, -0.116404, -0.124773
#*# 	  0.119426, 0.109621, 0.096939, 0.081308, 0.068184, 0.053573, 0.044760, 0.028969, 0.018120, 0.006283, -0.002908, -0.010791, -0.023741, -0.030162, -0.037073, -0.042683, -0.049352, -0.055295, -0.062029, -0.065874, -0.070149, -0.076995, -0.083826, -0.089938, -0.094344, -0.097857, -0.103091, -0.110319, -0.117867, -0.126452
#*# 	  0.117126, 0.108787, 0.095660, 0.079702, 0.066209, 0.053361, 0.042391, 0.027415, 0.019016, 0.005714, -0.004916, -0.012849, -0.025708, -0.030147, -0.039947, -0.039931, -0.051448, -0.056243, -0.060379, -0.064132, -0.070067, -0.076100, -0.081180, -0.087903, -0.091653, -0.098701, -0.103391, -0.107447, -0.116767, -0.126082
#*# 	  0.116599, 0.104343, 0.092698, 0.078576, 0.064534, 0.054385, 0.041239, 0.028794, 0.017551, 0.007659, -0.003602, -0.015075, -0.022075, -0.030447, -0.035919, -0.044550, -0.051138, -0.055225, -0.061501, -0.063522, -0.071142, -0.075536, -0.083251, -0.087481, -0.090958, -0.095571, -0.103038, -0.107415, -0.113677, -0.124019
#*# 	  0.111336, 0.102637, 0.088453, 0.074152, 0.063519, 0.053202, 0.039338, 0.026949, 0.016519, 0.005717, -0.004577, -0.016508, -0.024019, -0.031044, -0.036825, -0.045134, -0.051315, -0.056529, -0.060247, -0.065917, -0.070896, -0.077746, -0.081294, -0.085654, -0.090787, -0.093653, -0.102108, -0.106475, -0.113767, -0.122670
#*# 	  0.105449, 0.093455, 0.082648, 0.069024, 0.057215, 0.046627, 0.032342, 0.023318, 0.012450, 0.003450, -0.008371, -0.019765, -0.028527, -0.034723, -0.042474, -0.047515, -0.054235, -0.060064, -0.064958, -0.068819, -0.072640, -0.080578, -0.084889, -0.090106, -0.092427, -0.097775, -0.105936, -0.111918, -0.116969, -0.127133
#*# 	  0.097818, 0.089965, 0.077118, 0.064144, 0.052384, 0.041330, 0.031401, 0.019594, 0.011653, -0.000615, -0.010811, -0.021379, -0.030413, -0.039310, -0.045668, -0.051156, -0.059127, -0.063146, -0.068323, -0.071964, -0.077461, -0.083030, -0.087607, -0.092789, -0.096242, -0.100464, -0.103934, -0.114741, -0.120366, -0.128190
#*# 	  0.096981, 0.087021, 0.075629, 0.062643, 0.050851, 0.039342, 0.030774, 0.019228, 0.008782, -0.000884, -0.009875, -0.021531, -0.031064, -0.040519, -0.048082, -0.051438, -0.061546, -0.066818, -0.071769, -0.074993, -0.080998, -0.086470, -0.088919, -0.094825, -0.097071, -0.103689, -0.108770, -0.115299, -0.122944, -0.130821
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 225.0
#*# min_y = 22.0
#*# max_y = 210.0
