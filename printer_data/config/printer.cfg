[include mainsail.cfg]
[include config/mcu.cfg]
[include config/machine.cfg]
[include config/stepper_motors.cfg]
[include config/extruder.cfg]
[include config/eddy.cfg]
[include extras/*.cfg]

#####################################################################
#  Kinematics
#####################################################################

[printer]
kinematics: corexy
max_velocity: 400
max_accel: 8000
max_z_velocity: 30
max_z_accel: 500
# minimum_cruise_ratio: 0.5 # This left commented to not break older Klipper versions
square_corner_velocity: 5.0

[extruder]
step_pin: EBBCan: gpio18
dir_pin: EBBCan: gpio19
enable_pin: !EBBCan: gpio17
microsteps: 16
gear_ratio: 50:17
rotation_distance: 13.365
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: gpio7
max_extrude_only_distance: 500
sensor_type: MAX31865
sensor_pin: EBBCan:gpio9
spi_software_sclk_pin: EBBCan:gpio10
spi_software_mosi_pin: EBBCan:gpio8
spi_software_miso_pin: EBBCan:gpio11
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
control: pid
pid_kp: 18.288
pid_ki: 1.008
pid_kd: 82.978
min_temp: 0
max_temp: 280
min_extrude_temp: 0

[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PB1
max_power: 1.0
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769
control: pid
pid_kp: 57.866
pid_ki: 2.204
pid_kd: 379.748

[fan]
pin: EBBCan: gpio13 
kick_start_time: 0.5
off_below: 0.5

[heater_fan hotend_fan]
pin: EBBCan: gpio14
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
##  If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

[multi_pin controller_fans]
pins: PF7,PF9

[controller_fan controller_fan]
##  Controller fan
pin: multi_pin:controller_fans
max_power: 0.4
kick_start_time: 0.5
heater: heater_bed

[fan_generic vefach]
pin: PF6
shutdown_speed: 0.0
kick_start_time: 5.0
#max_power:
#shutdown_speed:
#cycle_time:
#hardware_pwm:
#kick_start_time:
#off_below:
#tachometer_pin:
#tachometer_ppr:
#tachometer_poll_interval:
#enable_pin:
#   See the "fan" section for a description of the above parameters.


# [neopixel hotend_rgb]
# pin: EBBCan:gpio16

[temperature_sensor chamber]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA7
min_temp: 0
max_temp: 100
gcode_id: C

[temperature_sensor MCU]
sensor_type: temperature_mcu

[temperature_sensor M8P]
sensor_type: temperature_host

[temperature_sensor SB]
sensor_type: Generic 3950
sensor_pin: EBBCan:gpio28

[adxl345]
cs_pin: EBBCan:gpio1
spi_software_sclk_pin: EBBCan:gpio2
spi_software_mosi_pin: EBBCan:gpio0
spi_software_miso_pin: EBBCan:gpio3
axes_map: z,-y,x

[resonance_tester]
probe_points: 100, 100, 20
accel_chip: adxl345

#[filament_switch_sensor runout_sensor]
#switch_pin: EBBCan:gpio21
#pause_on_runout: True

[output_pin caselight]
# Chamber Lighting - HE0 Connector (Optional)
pin: PA3
pwm:true
shutdown_value: 0
value:0.0
cycle_time: 0.01

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead

##--------------------------------------------------------------------
## Uncomment below for 250mm build
z_positions:
    -50, 18
    125, 245
    300, 18
points:
    230, 10
    10, 10
    127, 200
    

##--------------------------------------------------------------------

speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075


[safe_z_home]
home_xy_position: 127, 127
z_hop: 10
z_hop_speed: 25
speed: 200


[probe_eddy_current btt_eddy]
sensor_type: ldc1612
z_offset: 2.14
#i2c_address:
i2c_mcu: eddy  # This value is good for the Eddy USB but would need to be adjusted for the Eddy Coil according to the MCU you have used.
i2c_bus: i2c0f # This value is good for the Eddy USB but would need to be adjusted for the Eddy Coil according to the I2C bus you have used.
# Measure the offsets below using the method described here: https://www.klipper3d.org/Probe_Calibrate.html#calibrating-probe-x-and-y-offsets
# For a standard Voron stealthburner X carriage mount there should be no need to change the defaults below.
x_offset: 0
y_offset: 21.42

# This section is only relevant for Eddy USB. Comment it out for Eddy Coil.
[temperature_probe btt_eddy]
sensor_type: Generic 3950
sensor_pin: eddy:gpio26
horizontal_move_z: 2

###############################Macros and related################################
#This secton contains macros and related config sections. Some should be used, others are optional. Read the comment above each one to find out whether or not to uncomment it for your installation.


# Uncomment this if you are using Eddy as the probe AND the homing endstop AND would like to use the beta z-offset control
[save_variables]
filename: ~/printer_data/config/variables.cfg



# Uncomment this if you are using Eddy as the probe AND the homing endstop
[force_move]
enable_force_move: True # Allows a user to move the z axis down if they have no other means of homing Z and need to calibrate the Eddy.



# Uncomment this if you are using Eddy as the probe AND the homing endstop AND would like to use the beta z-offset control
[delayed_gcode RESTORE_PROBE_OFFSET]
initial_duration: 1.
gcode:
  {% set svv = printer.save_variables.variables %}
  {% if not printer["gcode_macro SET_GCODE_OFFSET"].restored %}
    SET_GCODE_VARIABLE MACRO=SET_GCODE_OFFSET VARIABLE=runtime_offset VALUE={ svv.nvm_offset|default(0) }
    SET_GCODE_VARIABLE MACRO=SET_GCODE_OFFSET VARIABLE=restored VALUE=True
  {% endif %}

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3241391.979,0.090000:3240474.077,0.130000:3239558.966,
#*# 	0.170000:3238627.818,0.210000:3237754.532,0.250000:3236832.760,
#*# 	0.290000:3235943.007,0.330000:3235063.806,0.370000:3234155.842,
#*# 	0.410000:3233293.865,0.450000:3232443.221,0.490000:3231569.827,
#*# 	0.530000:3230749.551,0.570000:3229889.006,0.610000:3229041.461,
#*# 	0.650000:3228231.842,0.690000:3227439.012,0.730000:3226639.649,
#*# 	0.770000:3225843.042,0.810000:3225066.864,0.850000:3224299.537,
#*# 	0.890000:3223550.175,0.930000:3222811.155,0.970000:3222094.876,
#*# 	1.010000:3221361.717,1.050000:3220645.772,1.090000:3219952.142,
#*# 	1.130000:3219251.754,1.170000:3218548.570,1.210000:3217906.490,
#*# 	1.250000:3217258.628,1.290000:3216607.059,1.330000:3215995.583,
#*# 	1.370000:3215367.209,1.410000:3214726.295,1.450000:3214138.976,
#*# 	1.490000:3213529.252,1.530000:3212963.197,1.570000:3212395.813,
#*# 	1.610000:3211803.823,1.650000:3211266.570,1.690000:3210695.336,
#*# 	1.730000:3210166.485,1.770000:3209639.848,1.810000:3209127.928,
#*# 	1.850000:3208609.162,1.890000:3208160.255,1.930000:3207619.183,
#*# 	1.970000:3207151.070,2.010000:3206667.531,2.050000:3206187.587,
#*# 	2.090000:3205720.997,2.130000:3205303.520,2.170000:3204854.399,
#*# 	2.210000:3204390.205,2.250000:3203967.939,2.290000:3203568.136,
#*# 	2.330000:3203154.404,2.370000:3202753.286,2.410000:3202339.364,
#*# 	2.450000:3201934.841,2.490000:3201580.886,2.530000:3201177.045,
#*# 	2.570000:3200822.082,2.610000:3200454.138,2.650000:3200103.335,
#*# 	2.690000:3199717.058,2.730000:3199352.447,2.770000:3199004.587,
#*# 	2.810000:3198685.847,2.850000:3198350.539,2.890000:3198028.121,
#*# 	2.930000:3197706.753,2.970000:3197385.480,3.010000:3197081.737,
#*# 	3.050000:3196776.289,3.090000:3196489.226,3.130000:3196202.844,
#*# 	3.170000:3195922.360,3.210000:3195606.819,3.250000:3195346.661,
#*# 	3.290000:3195060.586,3.330000:3194774.199,3.370000:3194536.654,
#*# 	3.410000:3194261.448,3.450000:3194015.522,3.490000:3193740.215,
#*# 	3.530000:3193522.014,3.570000:3193277.664,3.610000:3193036.189,
#*# 	3.650000:3192794.453,3.690000:3192550.283,3.730000:3192332.395,
#*# 	3.770000:3192084.279,3.810000:3191880.094,3.850000:3191655.393,
#*# 	3.890000:3191462.152,3.930000:3191252.382,3.970000:3191028.340,
#*# 	4.010000:3190831.611,4.050000:3190596.001
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 35.276779
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.051433, 0.054243, 0.057366, 0.047220, 0.039831, 0.038792, 0.025307, 0.021885, 0.024253, 0.018813, 0.025263, 0.034576, 0.039152, 0.032492, 0.043683, 0.045134, 0.043320, 0.055599, 0.045450, 0.040558
#*# 	  0.065796, 0.049665, 0.049665, 0.046857, 0.042642, 0.024912, 0.019516, 0.018507, 0.020174, 0.016798, 0.016798, 0.024956, 0.024605, 0.029342, 0.034576, 0.041601, 0.040195, 0.052474, 0.043683, 0.026315
#*# 	  0.055236, 0.062937, 0.064030, 0.048574, 0.044772, 0.035254, 0.021887, 0.015086, 0.007980, 0.013067, 0.019867, 0.023946, 0.021885, 0.030363, 0.024605, 0.032130, 0.030046, 0.031404, 0.039152, 0.021885
#*# 	  0.066111, 0.051747, 0.049665, 0.045087, 0.033898, 0.029693, 0.021533, 0.015437, 0.012061, 0.001884, 0.013769, 0.016140, 0.015437, 0.019516, 0.021885, 0.031767, 0.023902, 0.025263, 0.030724, 0.019165
#*# 	  0.059814, 0.062259, 0.060490, 0.047898, 0.035982, 0.035619, 0.017454, 0.015437, 0.001224, 0.006972, 0.004911, 0.011403, 0.011710, 0.013727, 0.013418, 0.015788, 0.016491, 0.023244, 0.007631, 0.013069
#*# 	  0.068245, 0.057730, 0.048939, 0.047220, 0.036658, 0.024956, 0.006621, 0.011710, 0.004953, -0.004915, -0.002195, -0.000487, 0.005612, 0.014779, 0.011358, 0.011710, 0.009339, 0.013769, 0.018508, 0.006314
#*# 	  0.062261, 0.058409, 0.051386, 0.041238, 0.033171, 0.017148, 0.003243, 0.000874, -0.003905, -0.010003, -0.007283, -0.005924, 0.001884, 0.006270, -0.004257, 0.005262, 0.007322, 0.007279, 0.000832, -0.002546
#*# 	  0.058773, 0.052427, 0.044411, 0.030726, 0.027981, 0.014076, 0.006270, -0.000838, -0.009652, -0.008644, -0.001145, -0.002898, -0.004915, 0.002542, 0.002894, 0.003901, 0.005612, 0.006621, 0.006619, -0.012390
#*# 	  0.062624, 0.061218, 0.056690, 0.044724, 0.033171, 0.021580, 0.011710, 0.000523, 0.002585, -0.005573, 0.006621, 0.003592, 0.002542, 0.003552, -0.002546, 0.007631, 0.000874, 0.005963, 0.003901, -0.005264
#*# 	  0.074199, 0.061218, 0.058044, 0.042279, 0.028684, 0.024605, 0.008990, 0.009032, 0.009690, 0.007631, 0.013420, 0.013727, 0.018507, 0.003243, 0.001533, 0.001533, 0.012762, 0.011710, 0.007980, 0.000216
#*# 	  0.077261, 0.069647, 0.059449, 0.048261, 0.035617, 0.028990, 0.013069, 0.006621, 0.022236, 0.011710, 0.010349, 0.019516, 0.013069, 0.005612, 0.001884, 0.008331, 0.015437, 0.004953, 0.008638, 0.001181
#*# 	  0.073929, 0.062259, 0.046855, 0.033171, 0.039468, 0.026622, 0.007980, 0.003901, 0.006972, 0.010349, 0.011708, 0.013769, 0.017806, 0.007631, 0.008988, 0.010349, 0.007631, 0.007322, 0.012410, -0.004257
#*# 	  0.073614, 0.072398, 0.070595, 0.051021, 0.044409, 0.028990, 0.021228, 0.011358, 0.012717, 0.006270, 0.019165, 0.013069, 0.003901, 0.009690, 0.002191, 0.008331, 0.016140, 0.007279, 0.009339, 0.007980
#*# 	  0.083023, 0.064706, 0.060177, 0.037386, 0.024605, 0.025659, 0.013067, 0.002892, 0.004559, 0.004251, 0.008681, 0.013769, 0.001884, 0.011356, 0.016798, 0.013067, 0.013420, 0.009032, 0.005963, -0.000529
#*# 	  0.079060, 0.074200, 0.059134, 0.054195, 0.038064, 0.027676, 0.017499, 0.016491, 0.003901, 0.008330, 0.004253, 0.006621, 0.008638, 0.007322, 0.006621, 0.002892, 0.010349, 0.012059, 0.004909, -0.001185
#*# 	  0.075458, 0.053832, 0.047170, 0.037071, 0.031087, 0.026973, 0.015788, 0.000523, 0.005260, -0.002546, -0.011373, 0.000874, -0.000487, 0.006972, 0.006972, 0.007673, 0.012368, 0.003243, 0.007629, 0.002892
#*# 	  0.076945, 0.070281, 0.067515, 0.058773, 0.040558, 0.033535, 0.023246, 0.020877, 0.009339, 0.013376, 0.013420, 0.012368, 0.008638, 0.005260, 0.007980, 0.009339, 0.012717, 0.015086, 0.018507, 0.012368
#*# 	  0.089369, 0.072398, 0.066839, 0.051747, 0.035980, 0.036706, 0.014430, 0.025263, 0.009339, 0.005612, 0.012717, 0.020526, 0.017149, 0.019867, 0.015787, 0.022587, 0.018155, 0.020526, 0.027676, 0.017148
#*# 	  0.082709, 0.081221, 0.063665, 0.056640, 0.055284, 0.046128, 0.032130, 0.019867, 0.015437, 0.018155, 0.018507, 0.014428, 0.017804, 0.016796, 0.018155, 0.016140, 0.017148, 0.019165, 0.018813, 0.019165
#*# 	  0.081492, 0.067878, 0.053832, 0.045087, 0.040921, 0.037384, 0.024956, 0.022894, 0.009690, 0.017850, 0.019209, 0.013727, 0.015789, 0.011358, 0.027324, 0.022894, 0.019823, 0.021885, 0.027325, 0.013069
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 224.82
#*# min_y = 22.0
#*# max_y = 209.9099999999999
